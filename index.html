<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delemencia - Oh, Okay.</title>
<link rel="icon" href="favicon.ico">
<style>
*{box-sizing:border-box;font-family:Segoe UI,Tahoma,Verdana;margin:0;padding:0}
body{height:100vh;display:flex;background:#e6f1fb}
.screen{display:none;position:absolute;width:100%;height:100%}
.auth-box{width:380px;margin:auto;background:#fff;border-radius:6px;box-shadow:0 0 10px rgba(0,0,0,.3);padding:30px;text-align:center}
.auth-box h1{color:#0078d7;margin-bottom:20px}
.auth-box input,.auth-box button{width:100%;padding:10px;margin-bottom:10px}
.auth-box button{border:none;border-radius:4px;background:#0078d7;color:#fff;font-weight:bold;cursor:pointer}
.link{font-size:13px;color:#0078d7;cursor:pointer;text-decoration:underline}
#container{display:flex;width:100%}
#sidebar{width:260px;background:#f0f6fc;border-right:1px solid #c4d9ed;display:flex;flex-direction:column;padding:10px}
#contacts,#online{flex:1;overflow-y:auto}
.contact{padding:6px;cursor:pointer;border-bottom:1px solid #c4d9ed}
.contact:hover{background:#d0e7fb}
#chatPane{flex:1;display:flex;flex-direction:column}
#chatHeader{padding:10px;border-bottom:1px solid #ccc;display:flex;justify-content:space-between;background:#f0f6fc}
#messages{flex:1;padding:10px;overflow-y:auto;background:#e5eff8}
.msg{margin-bottom:6px;padding:6px 10px;border-radius:6px;max-width:70%;background:#d0e7fb}
.msg.self{background:#0078d7;color:#fff;margin-left:auto}
#sendBox{display:flex;padding:10px;border-top:1px solid #ccc}
#sendBox input{flex:1;padding:8px}
#sendBox button{padding:8px 12px;border:none;background:#0078d7;color:#fff}
#settings{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:520px;background:#f0f6fc;padding:25px;border-radius:6px}
.setting-section{margin-bottom:20px}
.setting-section button{margin:5px;padding:6px 12px;border:none;border-radius:4px;background:#0078d7;color:#fff}
.delete{background:#a00}
.back{background:#555}
</style>
</head>
<body>

<div id="welcome" class="screen">
<div class="auth-box">
<h1>Delemencia</h1>
<button onclick="show('login')">Sign in</button>
<div class="link" onclick="show('register')">Create account</div>
</div>
</div>

<div id="register" class="screen">
<div class="auth-box">
<h1>Create account</h1>
<input id="ru" placeholder="Username">
<input id="rp" type="password" placeholder="Password">
<button onclick="register()">Create</button>
<div class="link" onclick="show('welcome')">Back</div>
</div>
</div>

<div id="login" class="screen">
<div class="auth-box">
<h1>Sign in</h1>
<input id="lu" placeholder="Username">
<input id="lp" type="password" placeholder="Password">
<button onclick="login()">Sign in</button>
<div class="link" onclick="show('welcome')">Back</div>
</div>
</div>

<div id="main" class="screen">
<div id="container">
<div id="sidebar">
<input id="addUser" placeholder="Add username">
<button onclick="addContact()">Add</button>
<h4>Contacts</h4>
<div id="contacts"></div>
<h4>Online</h4>
<div id="online"></div>
</div>

<div id="chatPane">
<div id="chatHeader">
<span id="chatName">Select chat</span>
<div>
<button onclick="call()">ðŸ“ž</button>
<button onclick="openSettings()">âš™</button>
</div>
</div>
<div id="messages"></div>
<div id="sendBox">
<input id="msg">
<button onclick="send()">Send</button>
</div>
</div>
</div>
</div>

<div id="settings">
<h2>Settings</h2>
<div class="setting-section">
<h3>Themes</h3>
<button onclick="theme('light')">Light</button>
<button onclick="theme('dark')">Dark</button>
<button onclick="theme('nebula')">Nebula</button>
<button onclick="theme('forest')">Forest</button>
<button onclick="theme('crimson')">Crimson</button>
</div>
<div class="setting-section">
<button onclick="logout()">Logout</button>
<button class="delete" onclick="del()">Delete account</button>
<button class="back" onclick="closeSettings()">Back</button>
</div>
</div>

<script>
let me=null,chat=null
const users=()=>JSON.parse(localStorage.users||"{}")
const save=u=>localStorage.users=JSON.stringify(u)

function show(x){document.querySelectorAll(".screen").forEach(s=>s.style.display="none");document.getElementById(x).style.display="block"}

function register(){
let u=ru.value.trim(),p=rp.value
let d=users()
if(!u||!p||d[u])return alert("Invalid")
d[u]={pass:p,contacts:[],msgs:{},online:Date.now()}
save(d);localStorage.me=u;me=u;load()
}

function login(){
let d=users()
if(!d[lu.value]||d[lu.value].pass!==lp.value)return alert("Wrong")
localStorage.me=lu.value;me=lu.value;load()
}

function load(){show("main");ping();renderContacts();setInterval(ping,5000);setInterval(renderOnline,3000)}

function ping(){let d=users();if(d[me]){d[me].online=Date.now();save(d)}}

function addContact(){
let u=addUser.value.trim(),d=users()
if(!d[u]||u===me)return alert("Invalid user")
if(!d[me].contacts.includes(u))d[me].contacts.push(u)
save(d);renderContacts()
}

function renderContacts(){
let d=users(),c=document.getElementById("contacts");c.innerHTML=""
d[me].contacts.forEach(u=>{
let div=document.createElement("div")
div.className="contact";div.textContent=u
div.onclick=()=>{chat=u;chatName.textContent=u;renderMsgs()}
c.appendChild(div)
})
}

function send(){
if(!chat||!msg.value)return
let d=users()
d[me].msgs[chat]??=[]
d[chat].msgs[me]??=[]
let m={from:me,text:msg.value,time:Date.now()}
d[me].msgs[chat].push(m)
d[chat].msgs[me].push(m)
msg.value=""
save(d);renderMsgs()
}

function renderMsgs(){
let d=users(),m=document.getElementById("messages");m.innerHTML=""
if(!chat)return
(d[me].msgs[chat]||[]).forEach(x=>{
let div=document.createElement("div")
div.className="msg"+(x.from===me?" self":"")
div.textContent=x.text
m.appendChild(div)
})
m.scrollTop=m.scrollHeight
}

function renderOnline(){
let d=users(),o=document.getElementById("online");o.innerHTML=""
Object.keys(d).forEach(u=>{
if(u!==me&&Date.now()-d[u].online<8000){
let div=document.createElement("div")
div.className="contact";div.textContent=u
o.appendChild(div)
}
})
}

function call(){
if(!chat)return alert("No user selected")
alert("Calling "+chat+"...")
}

function openSettings(){settings.style.display="block"}
function closeSettings(){settings.style.display="none"}

function theme(t){
if(t==="dark")document.body.style.background="#111"
if(t==="nebula")document.body.style.background="linear-gradient(135deg,#1a0033,#000)"
if(t==="forest")document.body.style.background="linear-gradient(135deg,#0b3d0b,#021)"
if(t==="crimson")document.body.style.background="linear-gradient(135deg,#6a0000,#200)"
if(t==="light")document.body.style.background="#e6f1fb"
}

function logout(){localStorage.removeItem("me");location.reload()}
function del(){let d=users();delete d[me];save(d);logout()}

if(localStorage.me){me=localStorage.me;load()}else show("welcome")
</script>

</body>
</html>
