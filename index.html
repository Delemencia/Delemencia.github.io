<!DOCTYPE html>
<html>
<head>
<title>Delemencia 1.0</title>
<link rel="icon" href="favicon.ico">

<style>
body {
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#0b1d33;
  color:white;
}

.screen {
  display:none;
  min-height:100vh;
  padding:20px;
  text-align:center;
}

button {
  padding:8px 14px;
  margin:6px;
  background:#1e90ff;
  border:none;
  color:white;
  cursor:pointer;
}

input {
  padding:6px;
  width:200px;
  margin:6px auto;
  display:block;
}

#app {
  display:flex;
  height:400px;
  background:white;
  color:black;
  max-width:700px;
  margin:0 auto;
}

#sidebar {
  width:180px;
  background:#e6e6e6;
  padding:5px;
  overflow-y:auto;
}

.contact {
  padding:6px;
  font-size:12px;
  cursor:pointer;
  border-bottom:1px solid #ccc;
}

.contact.active {
  background:#cfdfff;
}

#chatArea {
  flex:1;
  display:flex;
  flex-direction:column;
}

#chatBox {
  flex:1;
  padding:5px;
  overflow-y:auto;
  font-size:12px;
}

.message {
  margin:3px 0;
}

#messageInput {
  width:100%;
  box-sizing:border-box;
}

.dark { background:#0b1d33; color:white; }
.light { background:#f2f2f2; color:black; }
.nebula {
  background:radial-gradient(circle at top, #4b0082, #000010);
  color:white;
}
</style>
</head>

<body class="dark">

<div id="welcome" class="screen">
  <h1>Delemencia 1.0</h1>
  <button onclick="show('register')">Register</button>
  <button onclick="show('login')">Login</button>
</div>

<div id="register" class="screen">
  <h2>Register</h2>
  <input id="regUser" placeholder="Username">
  <input id="regPass" type="password" placeholder="Password">
  <button onclick="register()">Create Account</button>
  <button onclick="show('welcome')">Back</button>
</div>

<div id="login" class="screen">
  <h2>Login</h2>
  <input id="logUser" placeholder="Username">
  <input id="logPass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="show('welcome')">Back</button>
</div>

<div id="chat" class="screen">
  <h2>Delemencia Chat</h2>

  <div id="app">
    <div id="sidebar">
      <b>Contacts</b>
      <div id="contactList"></div>
      <input id="addUserInput" placeholder="Add username">
      <button onclick="addContact()">Add</button>
      <button onclick="show('settings')">Settings</button>
    </div>

    <div id="chatArea">
      <div id="chatBox"></div>
      <input id="messageInput" placeholder="Type message">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<div id="settings" class="screen">
  <h2>Settings</h2>

  <h3>Appearance</h3>
  <button onclick="setTheme('dark')">Dark</button>
  <button onclick="setTheme('light')">Light</button>
  <button onclick="setTheme('nebula')">Nebula</button>

  <h3>Account</h3>
  <button onclick="logout()">Logout</button>
  <button onclick="deleteAccount()">Delete Account</button>

  <button onclick="show('chat')">Back</button>
</div>

<script>
var currentUser = null
var currentChat = null

function users() {
  return JSON.parse(localStorage.getItem("users") || "{}")
}

function saveUsers(u) {
  localStorage.setItem("users", JSON.stringify(u))
}

function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.style.display = "none")
  document.getElementById(id).style.display = "block"
}

function register() {
  var u = regUser.value.trim()
  var p = regPass.value
  if (u.length < 3 || p.length < 3) return alert("Too short")

  var us = users()
  if (us[u]) return alert("Username exists")

  us[u] = { password:p, contacts:[], messages:{}, theme:"dark" }
  saveUsers(us)

  currentUser = u
  localStorage.setItem("currentUser", u)
  show("chat")
}

function login() {
  var u = logUser.value.trim()
  var p = logPass.value
  var us = users()

  if (us[u] && us[u].password === p) {
    currentUser = u
    localStorage.setItem("currentUser", u)
    setTheme(us[u].theme)
    show("chat")
    renderContacts()
  } else {
    alert("Wrong login")
  }
}

function logout() {
  localStorage.removeItem("currentUser")
  currentUser = null
  currentChat = null
  show("welcome")
}

function addContact() {
  var name = addUserInput.value.trim()
  var us = users()

  if (!us[name] || name === currentUser) return

  if (!us[currentUser].contacts.includes(name)) {
    us[currentUser].contacts.push(name)
    us[currentUser].messages[name] = ["Hello welcome to Delemencia!"]
    us[name].messages[currentUser] = ["Hello welcome to Delemencia!"]
    saveUsers(us)
    currentChat = name
    renderContacts()
    renderMessages()
  }
}

function renderContacts() {
  var us = users()
  contactList.innerHTML = ""

  us[currentUser].contacts.forEach(c => {
    var d = document.createElement("div")
    d.textContent = c
    d.className = "contact" + (c === currentChat ? " active" : "")
    d.onclick = () => {
      currentChat = c
      renderContacts()
      renderMessages()
    }
    contactList.appendChild(d)
  })
}

function renderMessages() {
  chatBox.innerHTML = ""
  if (!currentChat) return

  users()[currentUser].messages[currentChat].forEach(m => {
    var d = document.createElement("div")
    d.textContent = m
    d.className = "message"
    chatBox.appendChild(d)
  })
}

function sendMessage() {
  if (!currentChat || !messageInput.value) return

  var us = users()
  us[currentUser].messages[currentChat].push(currentUser + ": " + messageInput.value)
  us[currentChat].messages[currentUser].push(currentUser + ": " + messageInput.value)
  saveUsers(us)

  messageInput.value = ""
  renderMessages()
}

function setTheme(t) {
  document.body.className = t
  var us = users()
  if (currentUser) {
    us[currentUser].theme = t
    saveUsers(us)
  }
}

function deleteAccount() {
  var us = users()
  delete us[currentUser]
  saveUsers(us)
  logout()
}

var saved = localStorage.getItem("currentUser")
if (saved) {
  currentUser = saved
  setTheme(users()[saved].theme)
  show("chat")
  renderContacts()
} else {
  show("welcome")
}
</script>

</body>
</html>
