<!DOCTYPE html>
<html>
<head>
<title>Delemencia 1.0</title>
<link rel="icon" href="favicon.ico">
<style>
body {
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#0b1d33;
  color:white;
  overflow:hidden;
}

.screen {
  display:none;
  padding:20px;
  text-align:center;
}

input {
  display:block;
  margin:6px auto;
  padding:6px;
  width:200px;
}

button {
  padding:6px 12px;
  margin:5px;
  background:#1e90ff;
  border:none;
  color:white;
  cursor:pointer;
}

#lines {
  position:fixed;
  inset:0;
  z-index:-1;
}

.line {
  position:absolute;
  width:2px;
  height:100%;
  background:rgba(0,120,255,0.3);
}

#app {
  display:flex;
  height:420px;
  background:white;
  color:black;
}

#sidebar {
  width:170px;
  background:#e6e6e6;
  padding:5px;
  overflow-y:auto;
}

.contact {
  padding:4px;
  font-size:12px;
  cursor:pointer;
  border-bottom:1px solid #ccc;
}

.contact.active {
  background:#cfdfff;
}

#chatArea {
  flex:1;
  display:flex;
  flex-direction:column;
}

#chatBox {
  flex:1;
  padding:5px;
  overflow-y:auto;
  font-size:12px;
}

.message {
  margin:2px 0;
}

#messageInput {
  width:100%;
  box-sizing:border-box;
}

.dark { background:#0b1d33; color:white; }
.light { background:#f2f2f2; color:black; }
.nebula {
  background:radial-gradient(circle at top, #4b0082, #000010);
  color:white;
}
</style>
</head>
<body>

<div id="lines"></div>

<div id="welcome" class="screen">
<h1>Delemencia 1.0</h1>
<button onclick="showRegister()">Register</button>
<button onclick="showLogin()">Login</button>
</div>

<div id="register" class="screen">
<h2>Register</h2>
<input id="regUser" placeholder="Username">
<input id="regPass" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="showWelcome()">Back</button>
</div>

<div id="login" class="screen">
<h2>Login</h2>
<input id="logUser" placeholder="Username">
<input id="logPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="showWelcome()">Back</button>
</div>

<div id="chat" class="screen">
<div id="app">
  <div id="sidebar">
    <b>Contacts</b>
    <div id="contactList"></div>
    <input id="addUserInput" placeholder="Add username">
    <button onclick="addUser()">Add</button>
    <button onclick="showSettings()">Settings</button>
  </div>
  <div id="chatArea">
    <div id="chatBox"></div>
    <input id="messageInput" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>
</div>

<div id="settings" class="screen">
<h2>Settings</h2>

<b>Appearance</b>
<button onclick="setTheme('dark')">Dark</button>
<button onclick="setTheme('light')">Light</button>
<button onclick="setTheme('nebula')">Nebula</button>

<h3>Profile</h3>
<div id="profileName"></div>

<input id="newPass" type="password" placeholder="New password">
<button onclick="changePassword()">Change Password</button>

<button onclick="deleteAccount()">Delete Account</button>
<button onclick="logout()">Logout</button>
<button onclick="showChat()">Back</button>
</div>

<script>
var currentUser=null
var currentChat=null

function users(){ return JSON.parse(localStorage.getItem("users")||"{}") }
function saveUsers(u){ localStorage.setItem("users",JSON.stringify(u)) }

function hideAll(){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none")
}

function showWelcome(){ hideAll(); welcome.style.display="block" }
function showRegister(){ hideAll(); register.style.display="block" }
function showLogin(){ hideAll(); login.style.display="block" }
function showChat(){
  hideAll()
  chat.style.display="block"
  profileName.textContent="Logged in as: "+currentUser
  renderContacts()
  renderMessages()
}
function showSettings(){ hideAll(); settings.style.display="block" }

function register(){
  var u=regUser.value.trim()
  var p=regPass.value
  if(u.length<3||p.length<3){ alert("Too short"); return }
  var us=users()
  if(us[u]){ alert("Exists"); return }
  us[u]={password:p,contacts:[],messages:{},theme:"dark"}
  saveUsers(us)
  currentUser=u
  localStorage.setItem("currentUser",u)
  showChat()
}

function login(){
  var u=logUser.value.trim()
  var p=logPass.value
  var us=users()
  if(us[u]&&us[u].password===p){
    currentUser=u
    localStorage.setItem("currentUser",u)
    setTheme(us[u].theme)
    showChat()
  } else alert("Wrong login")
}

function logout(){
  localStorage.removeItem("currentUser")
  currentUser=null
  showWelcome()
}

function addUser(){
  var name=addUserInput.value.trim()
  var us=users()
  if(!us[name]||name===currentUser) return
  if(!us[currentUser].contacts.includes(name)){
    us[currentUser].contacts.push(name)
    us[currentUser].messages[name]=["Hello welcome to Delemencia!"]
    us[name].messages[currentUser]=["Hello welcome to Delemencia!"]
    saveUsers(us)
    currentChat=name
    renderContacts()
    renderMessages()
  }
}

function renderContacts(){
  var us=users()
  contactList.innerHTML=""
  us[currentUser].contacts.forEach(c=>{
    var d=document.createElement("div")
    d.textContent=c
    d.className="contact"+(c===currentChat?" active":"")
    d.onclick=()=>{ currentChat=c; renderContacts(); renderMessages() }
    contactList.appendChild(d)
  })
}

function renderMessages(){
  chatBox.innerHTML=""
  if(!currentChat) return
  users()[currentUser].messages[currentChat].forEach(m=>{
    var d=document.createElement("div")
    d.textContent=m
    d.className="message"
    chatBox.appendChild(d)
  })
}

function sendMessage(){
  if(!currentChat||!messageInput.value) return
  var us=users()
  us[currentUser].messages[currentChat].push(currentUser+": "+messageInput.value)
  us[currentChat].messages[currentUser].push(currentUser+": "+messageInput.value)
  saveUsers(us)
  messageInput.value=""
  renderMessages()
}

function setTheme(t){
  document.body.className=t
  var us=users()
  if(us[currentUser]){ us[currentUser].theme=t; saveUsers(us) }
}

function changePassword(){
  var us=users()
  if(newPass.value.length<3) return
  us[currentUser].password=newPass.value
  saveUsers(us)
  alert("Password changed")
}

function deleteAccount(){
  var us=users()
  delete us[currentUser]
  saveUsers(us)
  logout()
}

function initLines(){
  for(var i=0;i<25;i++){
    var l=document.createElement("div")
    l.className="line"
    l.style.left=Math.random()*100+"%"
    l.speed=0.3+Math.random()
    lines.appendChild(l)
  }
  function move(){
    document.querySelectorAll(".line").forEach(l=>{
      var x=parseFloat(l.style.left)
      x-=l.speed
      if(x<0) x=100
      l.style.left=x+"%"
    })
    requestAnimationFrame(move)
  }
  move()
}

var saved=localStorage.getItem("currentUser")
if(saved){ currentUser=saved; setTheme(users()[saved].theme); showChat() }
else showWelcome()
initLines()
</script>
</body>
</html>
