<!DOCTYPE html>
<html>
<head>
<title>Delemencia 1.0</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<style>
body { margin:0; font-family: Arial, Helvetica, sans-serif; background:#001f3f; color:white; overflow:hidden; }
.screen { display:none; padding:20px; text-align:center; }

input, select { display:block; margin:5px auto; padding:5px; width:200px; }
button { margin:5px; padding:5px 10px; background:#0074D9; color:white; border:none; cursor:pointer; }

#lines { position:absolute; width:100%; height:100%; top:0; left:0; z-index:-1; overflow:hidden; }
.line { position:absolute; width:2px; height:100%; background:rgba(0,100,255,0.3); }

#app { display:flex; height:400px; background:#fff; color:black; }
#sidebar { width:150px; background:#eee; padding:5px; overflow-y:auto; }
#sidebar b { display:block; margin-bottom:5px; color:black; }
.contact { padding:2px 5px; cursor:pointer; border-bottom:1px solid #ccc; }
.contact:hover { background:#ddd; }
#chatArea { flex:1; border-left:1px solid #aaa; display:flex; flex-direction:column; font-size:12px; }
#chatBox { flex:1; padding:5px; overflow-y:auto; background:#fff; }
.message { margin:2px 0; text-align:left; }
#messageInput { width:100%; padding:5px; }
#addUserInput { width:100%; padding:3px; font-size:12px; margin-bottom:3px; }
#settingsScreen { display:none; padding:20px; background:#001f3f; color:white; text-align:center; }

h1,h2 { margin:10px 0; }
</style>
</head>
<body>

<div id="lines"></div>

<div id="welcome" class="screen">
<h1>Welcome to Delemencia 1.0</h1>
<button onclick="showRegister()">Register</button>
<button onclick="showLogin()">Login</button>
</div>

<div id="register" class="screen">
<h2>Register</h2>
<input id="regUser" placeholder="Username 3-20 letters">
<input id="regPass" type="password" placeholder="Password 3-20 chars">
<button onclick="register()">Register</button>
<button onclick="showWelcome()">Back</button>
</div>

<div id="login" class="screen">
<h2>Login</h2>
<input id="logUser" placeholder="Username">
<input id="logPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="showWelcome()">Back</button>
</div>

<div id="chat" class="screen">
<h2>Delemencia Chat</h2>
<div id="app">
  <div id="sidebar">
    <b>Contacts</b>
    <div id="contactList"></div>
    <input id="addUserInput" placeholder="Add username">
    <button onclick="addUser()">Add</button>
    <button onclick="showSettings()">Settings</button>
  </div>
  <div id="chatArea">
    <div id="chatBox"></div>
    <input id="messageInput" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>
</div>

<div id="settingsScreen" class="screen">
<h2>Settings</h2>
<button onclick="logout()">Logout</button>
<button onclick="showChat()">Back</button>
</div>

<script>
var currentUser=null;
var currentChat=null;

function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
function saveUsers(users){ localStorage.setItem("users", JSON.stringify(users)); }
function saveCurrentUser(){ localStorage.setItem("currentUser", currentUser||""); }
function loadCurrentUser(){ var u=localStorage.getItem("currentUser"); if(u) currentUser=u; }

function hideAll(){
  document.getElementById("welcome").style.display="none";
  document.getElementById("register").style.display="none";
  document.getElementById("login").style.display="none";
  document.getElementById("chat").style.display="none";
  document.getElementById("settingsScreen").style.display="none";
}

function showWelcome(){ hideAll(); document.getElementById("welcome").style.display="block"; }
function showRegister(){ hideAll(); document.getElementById("register").style.display="block"; }
function showLogin(){ hideAll(); document.getElementById("login").style.display="block"; }
function showChat(){ hideAll(); document.getElementById("chat").style.display="block"; renderContacts(); renderMessages(); }
function showSettings(){ hideAll(); document.getElementById("settingsScreen").style.display="block"; }

function register(){
  var u=document.getElementById("regUser").value.trim();
  var p=document.getElementById("regPass").value;
  if(u.length<3||u.length>20||!/^[a-zA-Z]+$/.test(u)){ alert("Username 3-20 letters"); return; }
  if(p.length<3||p.length>20){ alert("Password 3-20 chars"); return; }
  var users=getUsers();
  if(users[u]){ alert("Username exists"); return; }
  users[u]={password:p, contacts:[], messages:{}};
  saveUsers(users);
  currentUser=u;
  saveCurrentUser();
  showChat();
}

function login(){
  var u=document.getElementById("logUser").value.trim();
  var p=document.getElementById("logPass").value;
  var users=getUsers();
  if(users[u]&&users[u].password===p){ currentUser=u; saveCurrentUser(); showChat(); }
  else { alert("Wrong username or password"); }
}

function logout(){ currentUser=null; currentChat=null; saveCurrentUser(); showWelcome(); }

function addUser(){
  var newUser=document.getElementById("addUserInput").value.trim();
  var users=getUsers();
  if(!newUser){ alert("Enter a username"); return; }
  if(!users[newUser]){ alert("User not found"); return; }
  if(newUser===currentUser){ alert("Cannot add yourself"); return; }
  if(users[currentUser].contacts.indexOf(newUser)===-1) users[currentUser].contacts.push(newUser);
  if(!users[currentUser].messages[newUser]) users[currentUser].messages[newUser]=["Hello welcome to Delemencia!"];
  if(!users[newUser].messages[currentUser]) users[newUser].messages[currentUser]=["Hello welcome to Delemencia!"];
  saveUsers(users);
  document.getElementById("addUserInput").value="";
  renderContacts();
}

function renderContacts(){
  var users=getUsers();
  var list=document.getElementById("contactList");
  list.innerHTML="";
  users[currentUser].contacts.forEach(function(c){
    var div=document.createElement("div");
    div.textContent=c;
    div.className="contact";
    div.onclick=function(){ currentChat=c; renderMessages(); };
    list.appendChild(div);
  });
}

function sendMessage(){
  if(!currentChat) return;
  var msg=document.getElementById("messageInput").value.trim();
  if(!msg) return;
  var users=getUsers();
  if(!users[currentUser].messages[currentChat]) users[currentUser].messages[currentChat]=[];
  if(!users[currentChat].messages[currentUser]) users[currentChat].messages[currentUser]=[];
  users[currentUser].messages[currentChat].push(currentUser+": "+msg);
  users[currentChat].messages[currentUser].push(currentUser+": "+msg);
  saveUsers(users);
  document.getElementById("messageInput").value="";
  renderMessages();
}

function renderMessages(){
  var chatBox=document.getElementById("chatBox");
  chatBox.innerHTML="";
  if(!currentChat) return;
  var users=getUsers();
  var msgs=users[currentUser].messages[currentChat]||[];
  msgs.forEach(function(m){
    var p=document.createElement("div");
    p.textContent=m;
    p.className="message";
    chatBox.appendChild(p);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
}


function initLines(){
  var container=document.getElementById("lines");
  for(var i=0;i<20;i++){
    var line=document.createElement("div");
    line.className="line";
    line.style.left=Math.random()*100+"%";
    line.style.height=(10+Math.random()*90)+"%";
    line.speed=0.5+Math.random()*1;
    container.appendChild(line);
  }
  requestAnimationFrame(moveLines);
}

function moveLines(){
  var lines=document.getElementsByClassName("line");
  for(var i=0;i<lines.length;i++){
    var left=parseFloat(lines[i].style.left);
    left-=lines[i].speed;
    if(left<-1) left=100;
    lines[i].style.left=left+"%";
  }
  requestAnimationFrame(moveLines);
}


loadCurrentUser();
if(currentUser){ showChat(); }
else{ showWelcome(); }
initLines();
</script>
</body>
</html>
