<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Delemencia 1.3 :+)</title>
<link rel="icon" type="image/png" href="logo.png"> 
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
*{font-family:'Segoe UI', Tahoma, sans-serif;margin:0;padding:0;box-sizing:border-box;border-radius:0 !important}
body{height:100vh;background:#0078d7;display:flex;align-items:center;justify-content:center;overflow:hidden;transition: background 0.3s}
#messages-box, #contacts-area, .tab-content, #recent-list, #selected-list {overflow-y: scroll}
::-webkit-scrollbar {width: 17px; background: #f0f0f0; border-left: 1px solid #dcdcdc}
::-webkit-scrollbar-thumb {background: #cdcdcd; border: 1px solid #ababab; box-shadow: inset 1px 1px 0 #eee}
::-webkit-scrollbar-button:single-button {background-color: #f0f0f0; display: block; height: 17px; width: 17px; border: 1px solid #dcdcdc}
.win-window{width:1050px;height:750px;background:#fff;border:1px solid #555;box-shadow:0 10px 40px rgba(0,0,0,0.5);display:flex;flex-direction:column;position:relative}
.win-titlebar {
    background: linear-gradient(to bottom, 
        rgba(235, 245, 255, 0.9) 0%, 
        rgba(210, 230, 250, 0.7) 45%, 
        rgba(180, 210, 240, 0.4) 50%, 
        rgba(200, 225, 250, 0.6) 100%);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    height: 32px;
    padding: 0 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 12px;
    color: #222;
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.9);
}
.title-left {
    display: flex;
    align-items: center;
    gap: 8px;
}
.skype-logo {
    width: 18px;
    height: 18px;
    background: #00aff0;
    color: white;
    border-radius: 50% !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.win-controls {
    display: flex;
    gap: 1px;
    align-self: flex-start;
    margin-top: 1px;
}
.ctrl-btn {
    width: 32px;
    height: 20px;
    background: linear-gradient(to bottom, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
    border: 1px solid rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #333;
}
.ctrl-close {
    background: linear-gradient(to bottom, #f5978e, #c23b2b);
    color: white;
    border: 1px solid #701b12;
}
.win-body{flex:1;display:flex;overflow:hidden}
#sidebar{width:300px;background:#f3f3f3;border-right:1px solid #ccc;display:flex;flex-direction:column}
.user-header{padding:15px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;gap:12px}
.pfp-wrap{position:relative;width:48px;height:48px}
.stat-dot{position:absolute;bottom:0;right:0;width:12px;height:12px;border:2px solid #fff}
.section-label{padding:10px 15px;font-size:11px;font-weight:bold;color:#4c76b2;text-transform:uppercase;background:#e9e9e9;border-bottom:1px solid #ddd;cursor:pointer}
.search-container { padding: 10px; background: #fff; border-bottom: 1px solid #ddd; }
.search-input { width: 100%; padding: 6px; border: 1px solid #ccc; font-size: 12px; outline: none; }
.person-item{padding:12px 15px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:13px;border-bottom:1px solid #eee;background:#fff}
#chat-pane, #home-pane{flex:1;display:flex;flex-direction:column;background:#fff}
#messages-box{flex:1;padding:20px;display:flex;flex-direction:column;gap:8px}
.msg-sender{font-weight:bold;color:#0078d7;margin-right:8px}
#input-area{padding:15px;border-top:1px solid #ccc;display:flex;gap:10px}
button{padding:6px 15px;background:#f0f0f0;border:1px solid #999;cursor:pointer;font-size:12px}
.modal{display:none;position:absolute;inset:0;background:rgba(0,0,0,0.3);z-index:999;align-items:center;justify-content:center}
.settings-win{background:#fff;border:1px solid #333;width:700px;height:500px;display:flex;position:relative}
.settings-nav{width:180px;background:#f9f9f9;border-right:1px solid #ccc;display:flex;flex-direction:column}
.nav-item{padding:15px;cursor:pointer;border-bottom:1px solid #eee;font-size:13px}
.nav-item.active{background:#fff;color:#0078d7;font-weight:bold}
.tab-content{flex:1;padding:30px;display:none}
.tab-content.active{display:block}
</style>
</head>
<body>
<div id="auth-screen" style="display:flex;width:100%;height:100%;align-items:center;justify-content:center">
    <div class="win-window" style="width:340px;height:auto">
        <div class="win-titlebar">
            <div class="title-left">
                <div class="skype-logo">T</div>
                <span>Delemencia 1.3 :+)</span>
            </div>
        </div>
        <div style="padding:30px" id="login-form">
            <input id="lu" placeholder="Username" style="width:100%;margin-bottom:10px;padding:8px">
            <input id="lp" type="password" placeholder="Password" style="width:100%;margin-bottom:20px;padding:8px">
            <div style="display:flex;gap:10px">
                <button onclick="login()" style="flex:1;background:#0078d7;color:#fff;border:none">Sign In</button>
                <button onclick="register()" style="flex:1">Register</button>
            </div>
        </div>
    </div>
</div>
<div id="app-screen" style="display:none;width:100%;height:100%">
    <div class="win-window" style="margin:auto;margin-top:40px">
        <div class="win-titlebar">
            <div class="title-left">
                <div class="skype-logo">T</div>
                <span>Delemencia 1.3 :+)</span>
            </div>
            <div class="win-controls">
                <div class="ctrl-btn">_</div>
                <div class="ctrl-btn">□</div>
                <div class="ctrl-btn ctrl-close">×</div>
            </div>
        </div>
        <div class="win-body">
            <div id="sidebar">
                <div class="user-header">
                    <div class="pfp-wrap">
                        <img id="my-pfp" src="" style="width:48px;height:48px;background:#eee;object-fit:cover">
                        <div id="my-vis-dot" class="stat-dot" style="background:green"></div>
                    </div>
                    <div><b id="display-name">User</b><br><span id="my-status-text" style="font-size:11px;color:#777">Online</span></div>
                </div>
                <div id="contacts-area">
                    <div class="search-container">
                        <input type="text" class="search-input" id="user-search" placeholder="Search..." onkeydown="if(event.key==='Enter')findUser()">
                    </div>
                    <div class="section-label" onclick="openSet()">SETTINGS</div>
                    <div class="section-label">CONTACTS</div>
                    <div id="people-list"></div>
                </div>
            </div>
            <div id="chat-pane">
                <div style="padding:15px;border-bottom:1px solid #eee;background:#fafafa">
                    <b id="chat-target-label">Select a contact</b>
                </div>
                <div id="messages-box"></div>
                <div id="input-area">
                    <input id="msg-in" type="text" style="flex:1;padding:8px" onkeydown="if(event.key==='Enter')doSend()">
                    <button onclick="doSend()" style="background:#0078d7;color:#fff;border:none">Send</button>
                </div>
            </div>
        </div>
        <div id="settings-box" class="modal">
            <div class="settings-win">
                <div class="settings-nav">
                    <div class="nav-item active">Profile</div>
                    <button onclick="closeModal()" style="margin:auto 10px 10px">Close</button>
                </div>
                <div class="tab-content active">
                    <h2>Settings</h2><br>
                    <button onclick="logout()" style="color:red">Logout</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
const firebaseConfig = {apiKey: "AIzaSyCjxTPqRH00ND04p0wDa9tI50Q6LSZEnJ8", authDomain: "delemencia.firebaseapp.com", databaseURL: "https://delemencia-default-rtdb.firebaseio.com", projectId: "delemencia", storageBucket: "delemencia.firebasestorage.app", messagingSenderId: "192535641895", appId: "1:192535641895:web:6a3d97d488ef6481d9f382"};
firebase.initializeApp(firebaseConfig);
const rdb = firebase.database();
let me = localStorage.getItem('del_me'), chatWith = null;
function login(){
    let u=document.getElementById('lu').value, p=document.getElementById('lp').value;
    if(!u) return;
    rdb.ref('users/'+u).once('value', s=>{
        if(s.val() && s.val().pass===p) session(u);
        else alert("Invalid login.");
    });
}
function register(){
    let u=document.getElementById('lu').value, p=document.getElementById('lp').value;
    if(!u || !p) return;
    rdb.ref('users/'+u).set({pass:p, pfp:"", status:"", vis:"Online"}).then(()=>session(u));
}
function session(u){
    me=u; localStorage.setItem('del_me', u);
    document.getElementById('display-name').textContent=u;
    document.getElementById('auth-screen').style.display='none'; document.getElementById('app-screen').style.display='flex';
    loadPeople();
}
function loadPeople(){
    rdb.ref('users').on('value', s=>{
        let pList=document.getElementById('people-list'); pList.innerHTML="";
        s.forEach(c=>{
            if(c.key===me) return;
            let div=document.createElement('div'); div.className="person-item";
            div.innerHTML=`<b>${c.key}</b>`;
            div.onclick=()=> startChat(c.key);
            pList.appendChild(div);
        });
    });
}
function startChat(user){
    chatWith=user; document.getElementById('chat-target-label').textContent=user;
    rdb.ref('chats/'+[me,chatWith].sort().join("_")).on('value', s=>{
        let b=document.getElementById('messages-box'); b.innerHTML="";
        s.forEach(c=>{ 
            let m=c.val(); let d=document.createElement('div');
            d.innerHTML=`<span class="msg-sender">${m.s}:</span> ${m.t}`;
            b.appendChild(d);
        });
        b.scrollTop=b.scrollHeight;
    });
}
function doSend(){
    let t=document.getElementById('msg-in').value; if(!chatWith||!t) return;
    rdb.ref('chats/'+[me,chatWith].sort().join("_")).push({s:me, t:t});
    document.getElementById('msg-in').value="";
}
function openSet(){ document.getElementById('settings-box').style.display='flex'; }
function closeModal(){ document.getElementById('settings-box').style.display='none'; }
function logout(){ localStorage.clear(); location.reload(); }
if(me) session(me);
</script>
</body>
</html>
