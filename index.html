<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WHAT ARE U THINKING</title>
<style>
*{
margin:0;padding:0;box-sizing:border-box;
font-family:Segoe UI,Tahoma
}
body{
height:100vh;
background:#cfe9cf;
overflow:hidden
}
.screen{display:none;position:absolute;width:100%;height:100%}

.lines{
position:absolute;width:100%;height:100%;
background:
linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
background-size:40px 40px;
animation:move 20s linear infinite;
pointer-events:none
}
@keyframes move{
from{background-position:0 0,0 0}
to{background-position:400px 400px,400px 400px}
}

.vista{
display:flex;align-items:center;justify-content:center;
background:linear-gradient(#dff5df,#9ccc9c)
}

.glass{
width:420px;
padding:30px;
background:#e8f6e8;
border:1px solid #6fa96f;
box-shadow:4px 4px 0 #4f7f4f;
text-align:center;
position:relative
}

.glass h1{font-size:34px;color:#1b5e20;margin-bottom:20px}

.glass button,
.auth button,
button{
border:1px solid #3a6b3a;
background:#b7e0b7;
padding:8px 12px;
cursor:pointer
}
button:hover{background:#9fd49f}

.auth{
width:380px;
background:#f2f2f2;
border:1px solid #999;
box-shadow:4px 4px 0 #666;
margin:auto;margin-top:100px;
padding:25px;
text-align:center
}

.auth input,input{
width:100%;
padding:8px;
border:1px solid #666;
background:#fff
}

#container{display:flex;height:100%}

#sidebar{
width:260px;
background:#e4f0e4;
border-right:2px solid #6fa96f;
padding:8px
}

#contacts,#online{
border:1px solid #6fa96f;
margin-top:6px;
height:200px;
overflow:auto
}

.contact{
padding:4px;
border-bottom:1px solid #6fa96f;
cursor:pointer
}
.contact:hover{background:#c8e6c9}

#chat{
flex:1;
display:flex;
flex-direction:column
}

#header{
background:#d8ecd8;
border-bottom:2px solid #6fa96f;
padding:6px;
display:flex;
justify-content:space-between;
align-items:center
}

.winbtn{
width:22px;height:22px;
border:1px solid #333;
background:#cfcfcf;
margin-left:4px;
font-weight:bold
}

#messages{
flex:1;
background:#f5fff5;
border-bottom:2px solid #6fa96f;
padding:6px;
overflow:auto
}

.msg{
border:1px solid #6fa96f;
margin-bottom:4px;
padding:4px;
max-width:70%
}
.self{
background:#b7e0b7;
margin-left:auto
}

#send{
display:flex;
padding:6px;
background:#e4f0e4
}

#settings{
display:none;
position:absolute;
top:50%;left:50%;
transform:translate(-50%,-50%);
width:560px;
background:#f0f0f0;
border:2px solid #333;
box-shadow:6px 6px 0 #000;
padding:10px
}

.setting{
border-top:1px solid #999;
padding-top:8px;
margin-top:8px
}

#spEffect{
position:fixed;
top:0;left:-100%;
width:100%;height:100%;
background:linear-gradient(90deg,rgba(0,255,200,.4),rgba(0,150,255,.4));
pointer-events:none;
z-index:999
}
</style>
</head>
<body>

<div id="spEffect"></div>

<div id="welcome" class="screen vista">
<div class="lines"></div>
<div class="glass">
<h1>Delemencia</h1>
<button onclick="show('login')">Sign in</button>
<button onclick="show('register')">Register</button>
</div>
</div>

<div id="register" class="screen vista">
<div class="lines"></div>
<div class="auth">
<input id="ru" placeholder="Username">
<input id="rp" type="password" placeholder="Password">
<button onclick="register()">Create</button>
</div>
</div>

<div id="login" class="screen vista">
<div class="lines"></div>
<div class="auth">
<input id="lu" placeholder="Username">
<input id="lp" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>
</div>

<div id="main" class="screen">
<div id="container">
<div id="sidebar">
<input id="addUser" placeholder="Add user">
<button onclick="addContact()">Add</button>

<h4>Contacts</h4>
<div id="contacts"></div>

<h4>Online</h4>
<div id="online"></div>
</div>

<div id="chat">
<div id="header">
<span id="chatName">Select chat</span>
<div>
<button class="winbtn" onclick="minimize()">‚ûñ</button>
<button class="winbtn" onclick="openSettings()">‚ùå</button>
</div>
</div>

<div id="messages"></div>

<div id="send">
<input id="msg">
<button onclick="send()">Send</button>
</div>
</div>
</div>
</div>

<div id="settings">
<div>
<button class="winbtn" onclick="minimize()">‚ûñ</button>
<button class="winbtn" onclick="closeSettings()">‚ùå</button>
</div>

<div class="setting">
<img id="pfp" width="64">
<input type="file" onchange="setPic(event)">
</div>

<div class="setting">
<select id="status" onchange="setStatus()">
<option>Online</option>
<option>Away</option>
<option>Busy</option>
<option>Invisible</option>
</select>
</div>

<div class="setting">
Volume
<input type="range" min="0" max="1" step="0.1" id="vol" onchange="setVol()">
</div>

<div class="setting">
<button onclick="callUser()">Call</button>
<button onclick="banUser()">Ban</button>
<button onclick="ignore()">Ignore</button>
</div>

<div class="setting">
<button onclick="sp()">SP</button>
</div>
</div>

<script>
let me=null,chat=null,volume=0.5
const db=()=>JSON.parse(localStorage.db||"{}")
const save=d=>localStorage.db=JSON.stringify(d)

function show(x){
document.querySelectorAll(".screen").forEach(s=>s.style.display="none")
document.getElementById(x).style.display="block"
}

function register(){
let d=db(),u=ru.value,p=rp.value
if(d[u]||!u||!p)return
d[u]={pass:p,contacts:[],msgs:{},status:"Online",pic:"",admin:u==="Delemencia",banned:false,online:Date.now()}
save(d);me=u;localStorage.me=u;load()
}

function login(){
let d=db(),u=lu.value
if(!d[u]||d[u].pass!==lp.value||d[u].banned)return
me=u;localStorage.me=u;load()
}

function load(){
show("main")
setInterval(ping,3000)
renderContacts()
}

function ping(){
let d=db()
if(d[me]){d[me].online=Date.now();save(d)}
renderOnline()
}

function addContact(){
let d=db(),u=addUser.value
if(d[u]&&!d[me].contacts.includes(u)&&u!==me){
d[me].contacts.push(u);save(d);renderContacts()
}
}

function renderContacts(){
let d=db(),c=contacts;c.innerHTML=""
d[me].contacts.forEach(u=>{
let div=document.createElement("div")
div.className="contact"
div.textContent=(u==="Delemencia"?"üëë ":"")+u
div.onclick=()=>{chat=u;chatName.textContent=u;renderMsgs()}
c.appendChild(div)
})
}

function renderOnline(){
let d=db(),o=online;o.innerHTML=""
Object.keys(d).forEach(u=>{
if(Date.now()-d[u].online<5000){
let div=document.createElement("div")
div.className="contact"
div.textContent=u
o.appendChild(div)
}
})
}

function send(){
if(!chat||!msg.value)return
let d=db()
d[me].msgs[chat]??=[]
d[chat].msgs[me]??=[]
let m={f:me,t:msg.value}
d[me].msgs[chat].push(m)
d[chat].msgs[me].push(m)
msg.value=""
save(d);renderMsgs()
}

function renderMsgs(){
let d=db(),m=messages;m.innerHTML=""
(d[me].msgs[chat]||[]).forEach(x=>{
let div=document.createElement("div")
div.className="msg"+(x.f===me?" self":"")
div.textContent=x.f+": "+x.t
m.appendChild(div)
})
}

function openSettings(){
settings.style.display="block"
pfp.src=db()[me].pic||""
}

function closeSettings(){settings.style.display="none"}
function minimize(){settings.style.display="none"}

function setPic(e){
let r=new FileReader()
r.onload=()=>{let d=db();d[me].pic=r.result;save(d)}
r.readAsDataURL(e.target.files[0])
}

function setStatus(){
let d=db();d[me].status=status.value;save(d)
}

function setVol(){volume=vol.value}

function callUser(){}

function banUser(){
let d=db()
if(!d[me].admin||!chat)return
d[chat].banned=true;save(d)
}

function ignore(){}

function sp(){
let e=document.getElementById("spEffect")
e.style.left="0"
setTimeout(()=>e.style.left="-100%",4000)
}

if(localStorage.me){me=localStorage.me;load()}else show("welcome")
</script>

</body>
</html>
